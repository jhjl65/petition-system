<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head>
    <meta charset="UTF-8">
    <title>–ü–µ—Ç–∏—Ü—ñ—ó –ö–∏—î–≤–∞</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<main class="container">
    <h1>–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ñ –ø–µ—Ç–∏—Ü—ñ—ó</h1>
    <header class="navbar">
        <div class="nav-container">
            <a class="nav-logo" th:href="@{/petitions}">–ü–µ—Ç–∏—Ü—ñ—ó –ö–∏—î–≤–∞</a>

            <div class="nav-links">
                <div sec:authorize="isAuthenticated()">
                    <a th:href="@{/petitions/create}" class="nav-btn">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ç–∏—Ü—ñ—é</a>
                    <form th:action="@{/auth/logout}" method="post" style="display:inline;">
                        <button type="submit" class="nav-btn logout">–í–∏–π—Ç–∏</button>
                    </form>
                </div>

                <div sec:authorize="isAnonymous()">
                    <a th:href="@{/auth/login}" class="nav-btn">–£–≤—ñ–π—Ç–∏</a>
                    <a th:href="@{/auth/register}" class="nav-btn">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
                </div>
            </div>
        </div>
    </header>

    <div class="petition-controls">
        <form th:action="@{/petitions}" method="get">
            <select name="status" onchange="this.form.submit()">
                <option th:value="all" th:selected="${filter == 'all'}">–£—Å—ñ</option>
                <option th:value="active" th:selected="${filter == 'active'}">–ê–∫—Ç–∏–≤–Ω—ñ</option>
            </select>
        </form>
    </div>

    <div class="petition-grid">
        <div class="petition-card" th:each="petition : ${petitions}">
            <div class="petition-img">
                <img th:if="${petition.imageData}" th:src="@{/petitions/{id}/image(id=${petition.id})}" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
                <div th:if="${petition.imageData == null}" class="no-image">üìÑ</div>
            </div>

            <div class="petition-info">
                <h3>
                    <a th:href="@{/petitions/{id}(id=${petition.id})}" th:text="${petition.title}"></a>
                </h3>

                <div class="progress-bar-container">
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill"
                             th:style="'width:' + (${#lists.size(petition.votes)} * 100 / ${petition.maxVotes}) + '%'">
                        </div>
                    </div>
                    <small>
                        <span th:text="${#lists.size(petition.votes)}"></span> / <span th:text="${petition.maxVotes}"></span> –≥–æ–ª–æ—Å—ñ–≤
                    </small>
                </div>

                <p class="deadline">
                    –ó–∞–ª–∏—à–∏–ª–æ—Å—å:
                    <span th:if="${T(java.time.LocalDateTime).now().isBefore(petition.deadline.atStartOfDay())}"
                          th:text="${T(java.time.temporal.ChronoUnit).DAYS.between(T(java.time.LocalDateTime).now(), petition.deadline.atStartOfDay())} + ' –¥–Ω.'"></span>
                    <span th:if="${T(java.time.LocalDateTime).now().isAfter(petition.deadline.atStartOfDay()) and T(java.time.LocalDateTime).now().isBefore(petition.deadline.atStartOfDay().plusHours(24))}"
                          th:text="${T(java.time.temporal.ChronoUnit).HOURS.between(T(java.time.LocalDateTime).now(), petition.deadline.atStartOfDay().plusHours(24))} + ' –≥–æ–¥.'"></span>
                </p>

                <p th:if="${#lists.size(petition.votes) >= petition.maxVotes or T(java.time.LocalDate).now().isAfter(petition.deadline)}"
                   class="status-ended">–ó–ê–í–ï–†–®–ï–ù–û</p>
            </div>
        </div>
    </div>
</main>
</body>
</html>
